<!DOCTYPE html>  <html> <head>   <title>page-control.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="class.html">                 class.js               </a>                                           <a class="source" href="page-control.html">                 page-control.js               </a>                                           <a class="source" href="module.html">                 module.js               </a>                                           <a class="source" href="ticker.html">                 ticker.js               </a>                                           <a class="source" href="history.html">                 history.js               </a>                                           <a class="source" href="site.html">                 site.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               page-control.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Part of the <a href="http://github.com/ff0000/rosy">Rosy Framework</a></h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* page-control.js */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Custom <a href="http://jslint.com">JSLint</a> settings.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global $: true, console: true, Class: true */</span>
<span class="cm">/*jslint browser: true, onevar: true */</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The RED Namespace</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">RED</span> <span class="o">=</span> <span class="nx">RED</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>RED.PageControl</h2>

<p>An iOS-style Page Control.</p>

<p>Usage:</p>

<pre><code>var control = new RED.PageControl({
    parent : $("#controller"),
    list : $("#controller &gt; ul"), // optional, assumes parent child as list
    items : $("#controller &gt; ul &gt; li") // optional, assumes list children as items
});

control.bind("paginate", function (e) {
    console.log(e);
});

control.bind("touchend", function (e) {
    console.log(e);
});
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">RED</span><span class="p">.</span><span class="nx">PageControl</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Extends RED.Module</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">return</span> <span class="nx">RED</span><span class="p">.</span><span class="nx">Module</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		
		<span class="nx">vars</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">className</span> <span class="o">:</span> <span class="s2">&quot;page-control&quot;</span><span class="p">,</span>
			<span class="nx">parent</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
			<span class="nx">list</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
			<span class="nx">items</span> <span class="o">:</span> <span class="kc">null</span>
		<span class="p">},</span>

		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">setupPageControl</span><span class="p">();</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Applies a matrix value to the target element</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">setTransform</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;-webkit-transform&quot;</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Resets transition duration to a specific value (or zero)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">resetTransition</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">timing</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">duration</span> <span class="o">+=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">duration</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;ms&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
			<span class="nx">timing</span> <span class="o">+=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">duration</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;ms&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
			<span class="nx">delay</span> <span class="o">+=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">duration</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;ms&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

			<span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
				<span class="s2">&quot;-webkit-transition-duration&quot;</span> <span class="o">:</span> <span class="nx">duration</span><span class="p">,</span>
				<span class="s2">&quot;-webkit-transition-timing-function&quot;</span> <span class="o">:</span> <span class="nx">timing</span><span class="p">,</span>
				<span class="s2">&quot;-webkit-transition-delay&quot;</span> <span class="o">:</span> <span class="nx">delay</span>
			<span class="p">});</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Returns the target element matrix</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">getMatrix</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">el</span><span class="p">;</span>
			
			<span class="kd">var</span> <span class="nx">transform</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kc">null</span><span class="p">).</span><span class="nx">webkitTransform</span><span class="p">,</span>
			    <span class="nx">matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebKitCSSMatrix</span><span class="p">(</span><span class="nx">transform</span><span class="p">);</span>

			<span class="k">return</span> <span class="nx">matrix</span><span class="p">;</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Setup page control functionality</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">setupPageControl</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">();</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">icons</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPageIndicators</span><span class="p">();</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">prepForTransforms</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">setupTouchEvents</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">sizeToFit</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">flagActiveItem</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">enable</span><span class="p">();</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Hardware accelerate everything.
Enables smooth animation effects while swiping</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">prepForTransforms</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">).</span><span class="nx">andSelf</span><span class="p">().</span><span class="nx">css</span><span class="p">({</span>
				<span class="s2">&quot;-webkit-transform&quot;</span> <span class="o">:</span> <span class="s2">&quot;translate3d(0, 0, 0)&quot;</span>
			<span class="p">});</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Where the magic happens.
Sets up touch event listeners for swipe handling.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">setupTouchEvents</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Shared variables</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span>
			    <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span><span class="p">,</span>
			    <span class="nx">matrix</span><span class="p">,</span> <span class="nx">touch</span><span class="p">,</span> <span class="nx">startX</span><span class="p">,</span> <span class="nx">currX</span><span class="p">,</span> <span class="nx">diffX</span><span class="p">,</span>
			    <span class="nx">startY</span><span class="p">,</span> <span class="nx">currY</span><span class="p">,</span> <span class="nx">diffY</span><span class="p">,</span> <span class="nx">touches</span><span class="p">,</span>
			    <span class="nx">directionX</span><span class="p">,</span> <span class="nx">oldX</span><span class="p">,</span> <span class="nx">touchMoveFired</span><span class="p">,</span> <span class="nx">touchEndFired</span><span class="p">,</span> <span class="nx">activeElement</span><span class="p">,</span>
			    <span class="nx">elementWidth</span><span class="p">,</span> <span class="nx">elementThreshold</span><span class="p">,</span> <span class="nx">lockHorizontal</span><span class="p">,</span>
			    <span class="nx">controlRect</span><span class="p">,</span> <span class="nx">listRect</span><span class="p">;</span>
			
			<span class="nx">list</span><span class="p">.</span><span class="nx">bind</span><span class="p">({</span>
				</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <ul>
<li>Reset shared variables on touchstart.</li>
<li>Reset transition duration to 350ms.</li>
<li>Reset transform values.</li>
<li>Cache as much information as possible to avoid overloading touchmove event (much more expensive)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">touchstart</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s2">&quot;ontouchstart&quot;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">))</span> <span class="p">{</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
					<span class="p">}</span>
					
					<span class="nx">activeElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getActiveElement</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeElement</span> <span class="o">||</span> <span class="o">!</span><span class="nx">activeElement</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span>
	
					<span class="nx">matrix</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMatrix</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
				
					<span class="k">this</span><span class="p">.</span><span class="nx">resetTransition</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="mi">350</span><span class="p">);</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
					
					<span class="nx">touchEndFired</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					<span class="nx">lockHorizontal</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

					<span class="nx">currX</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
					<span class="nx">diffX</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

					<span class="nx">currY</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
					<span class="nx">diffY</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

					<span class="nx">touches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

					<span class="nx">touch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getTouchObject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

					<span class="nx">startX</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
					<span class="nx">startY</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>

					<span class="nx">elementWidth</span> <span class="o">=</span> <span class="nx">elementWidth</span> <span class="o">||</span> <span class="nx">activeElement</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
					<span class="nx">elementThreshold</span> <span class="o">=</span> <span class="nx">elementThreshold</span> <span class="o">||</span> <span class="nx">elementWidth</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
				<span class="p">},</span> <span class="k">this</span><span class="p">),</span>
				</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <ul>
<li>Detect if user is swiping horizontally</li>
<li>Lock x-axis, track user swipe</li>
<li>Set CSS transform based on user movement</li>
<li>Reset CSS transition duration to 0 (don't want it to interfere with user movement)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">touchmove</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">touch</span> <span class="o">||</span> <span class="nx">touchEndFired</span> <span class="o">||</span> <span class="o">!</span><span class="nx">activeElement</span> <span class="o">||</span> <span class="o">!</span><span class="nx">activeElement</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span>

					<span class="nx">touch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getTouchObject</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

					<span class="nx">currX</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
					<span class="nx">currY</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>

					<span class="nx">directionX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currX</span> <span class="o">&gt;</span> <span class="nx">oldX</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;left&quot;</span> <span class="o">:</span> <span class="s2">&quot;right&quot;</span><span class="p">;</span>
					<span class="nx">oldX</span> <span class="o">=</span> <span class="nx">currX</span><span class="p">;</span>

					<span class="nx">diffX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currX</span> <span class="o">-</span> <span class="nx">startX</span><span class="p">);</span>
					<span class="nx">diffY</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currY</span> <span class="o">-</span> <span class="nx">startY</span><span class="p">);</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lockHorizontal</span> <span class="o">&amp;&amp;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">diffY</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">activeElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nx">lockHorizontal</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
					<span class="p">}</span>
					
					<span class="nx">listRect</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
					<span class="nx">controlRect</span> <span class="o">=</span> <span class="nx">control</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
					
					<span class="k">if</span> <span class="p">(</span><span class="nx">listRect</span><span class="p">.</span><span class="nx">left</span> <span class="o">&gt;=</span> <span class="nx">controlRect</span><span class="p">.</span><span class="nx">left</span> <span class="o">||</span> <span class="nx">listRect</span><span class="p">.</span><span class="nx">right</span> <span class="o">&lt;=</span> <span class="nx">controlRect</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">diffX</span> <span class="o">*=</span> <span class="mf">0.5</span><span class="p">;</span>
					<span class="p">}</span>

					<span class="k">this</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">diffX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
					
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">touchMoveFired</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">resetTransition</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="p">}</span>
					
					<span class="nx">touchMoveFired</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">},</span> <span class="k">this</span><span class="p">),</span>
				</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <ul>
<li>Calculate total user movement</li>
<li>If movement threshold is reached, snap to prev/next sibling</li>
<li>Else snap to current element</li>
<li>Triggers touchend event</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">touchend</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeElement</span> <span class="o">||</span> <span class="o">!</span><span class="nx">activeElement</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span>

					<span class="nx">touchEndFired</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
					<span class="nx">touchMoveFired</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

					<span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">activeElement</span><span class="p">,</span>
					    <span class="nx">difference</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">diffX</span><span class="p">),</span>
					    <span class="nx">getSibling</span> <span class="o">=</span> <span class="p">(</span><span class="nx">difference</span> <span class="o">&gt;</span> <span class="nx">elementThreshold</span><span class="p">);</span>

					<span class="k">if</span> <span class="p">(</span><span class="nx">getSibling</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">findSibling</span><span class="p">(</span><span class="nx">activeElement</span><span class="p">,</span> <span class="nx">diffX</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>
					<span class="p">}</span>
					
					<span class="k">this</span><span class="p">.</span><span class="nx">flagActiveItem</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">animateTo</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">control</span><span class="p">,</span> <span class="nx">list</span><span class="p">);</span>
					
					<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;touchend&quot;</span><span class="p">);</span>
				<span class="p">},</span> <span class="k">this</span><span class="p">),</span>
				</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>A safety catcher for CSS transitions. Nutshell: in some cases transitions are offset by ~1px. This listener fires at the end of a transition event and makes sure the values end on a round number.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">webkitTransitionEnd</span> <span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">roundMatrixValues</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
			<span class="p">});</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Returns the first touch object in touch array.
Fallback to default event object if no touch object found.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">getTouchObject</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">||</span> <span class="nx">e</span><span class="p">;</span>
			<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">e</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Bubbles up to immediate parent child node.
Prevents accidental event delegation.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">getActiveElement</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
			
			<span class="k">while</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">!==</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <ul>
<li>Applies clearfix to parent node</li>
<li>Floats child nodes</li>
<li>Calculates individual node width</li>
<li>Resizes parent node to total child node width value.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">sizeToFit</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span>
			    <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">itemWidth</span><span class="p">;</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;overflow&quot;</span><span class="p">,</span> <span class="s2">&quot;hidden&quot;</span><span class="p">);</span>
			
			<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
				<span class="nx">itemWidth</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>
				
				<span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">);</span>
				<span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">());</span>
				
				<span class="nx">width</span> <span class="o">+=</span> <span class="nx">itemWidth</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Creates a page indicator for each found child node.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">createPageIndicators</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span>
			    <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span>
			    <span class="nx">controller</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;page-indicators&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">),</span>
			    <span class="nx">controlList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;ul&gt;&lt;/ul&gt;&#39;</span><span class="p">),</span>
			    <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">icon</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">icon</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&lt;/li&gt;&#39;</span><span class="p">);</span>
				
				<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">icon</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-active&quot;</span><span class="p">);</span>
				<span class="p">}</span>
				
				<span class="nx">controlList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">icon</span><span class="p">);</span>
			<span class="p">}</span>
			
			<span class="nx">controller</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">controlList</span><span class="p">);</span>
			<span class="nx">control</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">controller</span><span class="p">);</span>
			
			<span class="k">return</span> <span class="nx">controlList</span><span class="p">.</span><span class="nx">children</span><span class="p">();</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Finds prev/next available sibling element.
Defaults to current element if none found.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">findSibling</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">sib</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">sib</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">sib</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">prev</span><span class="p">();</span>
			<span class="p">}</span>

			<span class="k">return</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">sib</span> <span class="o">:</span> <span class="nx">element</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <ul>
<li>Calculates difference between current position and destination.</li>
<li>Resets transition duration to 350ms.</li>
<li>Animates to destination.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">animateTo</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">control</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">element</span><span class="p">;</span>
			
			<span class="kd">var</span> <span class="nx">matrix</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMatrix</span><span class="p">(</span><span class="nx">list</span><span class="p">),</span>
			    <span class="nx">elementOffset</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">control</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">;</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">resetTransition</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="mi">350</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nx">elementOffset</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Looks through target element matrix and rounds each available value.
This resolves the ~1px offset issue when animating with CSS transforms.
Triggers paginate event when finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">roundMatrixValues</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">),</span>
				    <span class="nx">matrix</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMatrix</span><span class="p">(</span><span class="nx">el</span><span class="p">),</span>
				    <span class="nx">key</span><span class="p">;</span>
			
				<span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">matrix</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">matrix</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">matrix</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			
				<span class="k">this</span><span class="p">.</span><span class="nx">resetTransition</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">matrix</span><span class="p">);</span>
				
				<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;paginate&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Flags item as active.
Removes active class name from siblings.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">flagActiveItem</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
			
			<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span>
			     <span class="nx">icons</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">icons</span><span class="p">,</span>
			     <span class="nx">index</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">icons</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">icons</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-active&quot;</span><span class="p">);</span>
				<span class="nx">icons</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">index</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-active&quot;</span><span class="p">).</span><span class="nx">siblings</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Sets default classes.
Used in required page-control.css</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">enable</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-list&quot;</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-items&quot;</span><span class="p">);</span>
			
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vars</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s2">&quot;-enabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
<span class="p">}.</span><span class="nx">call</span><span class="p">(</span><span class="nx">RED</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 